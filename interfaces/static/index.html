<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<link rel="shortcut icon" href="img/favicon.ico" />
<script type="text/javascript">

</script>
<title>Camoco - Cash - Money - Corn</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel='stylesheet' type='text/css'  href="static/css/main.css">
<!-- CDNS -->
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type='text/javascript' src='static/js/cytoscape/build/cytoscape.js'></script>
<script type='text/javascript' src='static/js/cytoscape/lib/arbor.js'></script>

<link rel='stylesheet' type='text/css'  href="static/css/jquery.dataTables.css">
<script src="static/js/datatables/jquery.dataTables.js"></script>


<script type="text/javascript">
<!--

////////////////////////////////////
//////		HTML methods	////
////////////////////////////////////

arbor_options = {
    name: 'arbor',

    liveUpdate: false, // whether to show the layout as it's running
    ready: undefined, // callback on layoutready 
    stop: undefined, // callback on layoutstop
    maxSimulationTime: 4000, // max length in ms to run the layout
    fit: true, // reset viewport to fit default simulationBounds
    padding: [ 50, 50, 50, 50 ], // top, right, bottom, left
    simulationBounds: undefined, // [x1, y1, x2, y2]; [0, 0, width, height] by default
    ungrabifyWhileSimulating: true, // so you can't drag nodes during layout

    // forces used by arbor (use arbor default on undefined)
    repulsion: undefined,
    stiffness: undefined,
    friction: undefined,
    gravity: true,
    fps: undefined,
    precision: undefined,

    // static numbers or functions that dynamically return what these
    // values should be for each element
    nodeMass: undefined, 
    edgeLength: function(edge){edge['score']},

    stepSize: 1, // size of timestep in simulation

    // function that returns true if the system is stable to indicate
    // that the layout can be stopped
    stableEnergy: function( energy ){
      var e = energy; 
      return (e.max <= 0.5) || (e.mean <= 0.3);
    }
};

cose_options = {
    name: 'cose',
    // Called on `layoutready`
    ready               : function() {},
    // Called on `layoutstop`
    stop                : function() {},
    // Number of iterations between consecutive screen positions update (0 -> only updated on the end)
    refresh             : 0,
    // Whether to fit the network view after when done
    fit                 : true, 
    // Padding on fit
    padding             : 30, 
    // Whether to randomize node positions on the beginning
    randomize           : true,
    // Whether to use the JS console to print debug messages
    debug               : false,
    // Node repulsion (non overlapping) multiplier
    nodeRepulsion       : 10000,
    // Node repulsion (overlapping) multiplier
    nodeOverlap         : 10,
    // Ideal edge (non nested) length
    idealEdgeLength     : 10,
    // Divisor to compute edge forces
    edgeElasticity      : 100,
    // Nesting factor (multiplier) to compute ideal edge length for nested edges
    nestingFactor       : 5, 
    // Gravity force (constant)
    gravity             : 250, 
    // Maximum number of iterations to perform
    numIter             : 100,
    // Initial temperature (maximum node displacement)
    initialTemp         : 200,
    // Cooling factor (how the temperature is reduced between consecutive iterations
    coolingFactor       : 0.95, 
    // Lower temperature threshold (below this point the layout will end)
    minTemp             : 1
};


$(document).ready(function(){
    // Initialize Cytoscape
    cy = cytoscape(options = {
        container : document.getElementById('cy'),    

        hideEdgesOnViewport: true,
        hideLabelsOnViewport: true,
        // Style
        style: cytoscape.stylesheet()
        .selector('node')
        .css({
            'background-color': '#144566',
            'border-width': 1,
            'border-color': '#000',
            'height':'mapData(degree,1,10,30,100)'
        })
        .selector(':selected')
        .css({
            'border-width': 3,
            'border-color': '#09BA00'
        })
        .selector('edge')
        .css({
            'opacity': '0.25',
            'width': 'mapData(score, 3, 7, 1, 20)',
            'curve-style': 'haystack' // fast edges!
        }),
        layout: {
            name: 'concentric',
            concentric: function(){ return this.data('score'); },
            levelWidth: function( nodes ){ return 10; },
            padding: 10
        },
        ready : function(){
            console.log('Cytoscape Web, ready to rock!')
        }
    })
    
    // Initialize Tables
    $('#OntologyTable').DataTable({
       "ajax":"Camoco/available_datasets/Ontology",
        "processing" : true,
        "paginate" : false,
        'scrollCollapse': true,
        'scrollY' : '500px'
    });
    $('#OntologyTable tbody').on('click','tr', function() {
        var name = $('td',this).eq(0).text();
        TermTable = $('#TermTable').DataTable()
        TermTable.clear().ajax.url("Ontology/Terms/"+name).load().draw()
        document.LoadedOntology = name
    });
    $('#TermTable').DataTable({
        "processing" : true,
        "paginate" : false,
        'scrollCollapse': true,
        'scrollY' : '500px'
    })

    $('#TermTable tbody').on('click','tr', function(){
        document.LoadedTerm = $('td',this).eq(0).text();
        $.getJSON('api/COB/ROOT/'+document.LoadedOntology+'/'+document.LoadedTerm)
        .done(function(data){
            a = data
            console.log('loading data')
            cy.load(data,function(){console.log('Loaded')},function(){console.log('Loaded2')})
            cy.layout(arbor_options)
        })
        .fail(function(data){
            console.log("Nopers")
        })
    })

});

-->
</script>
</head>
<body>

<div id="DatasetTables">
    <table id="OntologyTable" class='display' cellspacing='0' width='100%'>
        <thead>
            <th>Ontology</th>
            <th>Description</th>
        </thead>
    </table>
    <table id="TermTable" class='display' cellspacing='0' width='100%'>
        <thead>
            <th>Term ID</th>
            <th>Term Name</th>
            <th>Num Genes</th>
        </thead> 
    </table>
</div>

<div id='cy'></div>

</body>
</html>
